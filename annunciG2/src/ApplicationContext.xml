<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
	http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
	http://www.springframework.org/schema/tx 
	http://www.springframework.org/schema/tx/spring-tx-2.0.xsd
	http://www.springframework.org/schema/aop 
	http://www.springframework.org/schema/aop/spring-aop-2.0.xsd">

<bean id="collezioniSpring" class="it.geek.annunci.util.Collezioni">
		<property name="jdbcTemplate">
			<ref bean="jdbcTemplate"></ref>
		</property>
</bean>

<bean id="utenti" class="it.geek.annunci.dao.UtenteDAO">
	<property name="jdbcTemplate">
	<ref bean="jdbcTemplate"></ref> 
	</property>
</bean>

<bean id="annuncioSpring" class="it.geek.annunci.dao.AnnuncioDao">
		<property name="jdbcTemplate">
			<ref bean="jdbcTemplate"></ref>
		</property>
</bean>		

<bean id="utenteSpring" class="it.geek.annunci.dao.UtenteDao">
		<property name="jdbcTemplate">
			<ref bean="jdbcTemplate"></ref>
		</property>
</bean>

<bean id="prodottoSpring" class="it.geek.annunci.dao.ProdottoDao">
	<property name="jdbcTemplate">
		<ref bean="jdbcTemplate"></ref>
	</property>


</bean>		


<bean id="sutenti" class="it.geek.annunci.service.UtenteService">
		<property name="utenteDao">
			<ref bean="utenteSpring"></ref>
		</property>
</bean>


<bean id="sannunci" class="it.geek.annunci.service.AnnuncioService">
		<property name="prodottoDao">
			<ref bean="prodottoSpring"></ref>
		</property>
		<property name="annuncioDao">
			<ref bean="annuncioSpring"></ref>
		</property>
</bean>

<bean id="scollezioni" class="it.geek.annunci.service.CollezioniService">
		<property name="collezioni">
			<ref bean="collezioniSpring"></ref>
		</property>
</bean>

<bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
	<property name="jndiName">
		<value>java:/comp/env/jdbc/annunciDB</value>
	</property>
</bean>

<bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
	<property name="dataSource" ref="dataSource"/>
</bean>


<tx:advice id="residenzaTxAdvice"
	transaction-manager="residenzaTxManager">
		
	<tx:attributes>
		<tx:method name="*Multiplo" rollback-for="RuntimeException"
				propagation="REQUIRED"/>
		<tx:method name="get" read-only="true"/>		
	</tx:attributes>
</tx:advice>

	<aop:config>
	
		<aop:pointcut id="residenzaMethods"
				expression="execution(* it.geek.residenzaSpring.service.*Interface.*(..))"/>
		
		<aop:advisor advice-ref="residenzaTxAdvice"
				pointcut-ref="residenzaMethods"/>				
	
	</aop:config>

	<bean id="residenzaTxManager"
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="dataSource"/>
	</bean>



</beans>

